---
import BaseLayout from '../layouts/BaseLayout.astro';
import resume from '../data/resume.json';

const toSlug = (value) =>
  (value ?? '')
    .toString()
    .trim()
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/^-+|-+$/g, '');

const skillGroups = resume.skills ?? [];
const certifications = resume.certifications ?? [];
const learning = resume.learning ?? [];
const productSystems = (resume.productSystems ?? []).map((system) => ({
  ...system,
  slug: toSlug(system.name)
}));

const skillChartConfigs = skillGroups
  .map((group) => {
    const items = group.items ?? [];
    const sortedItems = [...items].sort((a, b) => b.count - a.count);
    const maxValue = sortedItems.reduce((max, item) => Math.max(max, item.count ?? 0), 0);
    return {
      category: group.category,
      items: sortedItems,
      maxValue: Math.max(maxValue, 1)
    };
  })
  .filter((config) => config.items.length > 0);
---

<BaseLayout title="Skills — yukassa" description="カテゴリ別のスキル実績と直近の学習状況。棒グラフで実践頻度を直感的に把握できます。">
  <article class="page">
    <header class="page__hero container">
      <p class="page__eyebrow">Skills</p>
      <h1>実務に根差したスキルプロフィール</h1>
      <p class="page__lead">
        プロダクト開発で繰り返し使ってきたスキルをカテゴリ別に整理しました。
        棒グラフで直近 24 ヶ月の実務投入回数を可視化しています。
      </p>
    </header>

    <section class="panel-grid container">
      <article class="panel panel--skills">
        <header class="panel__header">
          <div>
            <h2>Skill Utilization</h2>
            <p class="panel__lead">カテゴリごとの棒グラフで稼働頻度の高い領域を俯瞰できます。</p>
          </div>
        </header>
        <div class="panel__charts">
          {skillChartConfigs.map((config) => (
            <article class="chart-card">
              <header>
                <h3>{config.category}</h3>
              </header>
              <ul class="bar-chart" role="list">
                {config.items.map((item) => (
                  <li
                    class="bar-chart__item"
                    style={`--value: ${item.count ?? 0}; --max: ${config.maxValue};`}
                    aria-label={`${item.name} ${item.count ?? 0} セッション`}
                  >
                    <div class="bar-chart__meta">
                      <span class="bar-chart__label">{item.name}</span>
                      <span class="bar-chart__count" aria-hidden="true">{item.count}</span>
                    </div>
                    <div class="bar-chart__track" aria-hidden="true">
                      <div class="bar-chart__fill"></div>
                    </div>
                  </li>
                ))}
              </ul>
            </article>
          ))}
        </div>
      </article>

      {productSystems.length > 0 && (
        <article class="panel panel--systems">
          <header class="panel__header">
            <div>
              <h2>Product System Overview</h2>
              <p class="panel__lead">担当プロダクトのシステム構成と技術要素のダミー概要です。</p>
            </div>
          </header>
          <div class="system-grid">
            {productSystems.map((system) => (
              <article
                class="system-card"
                id={system.slug ? `product-${system.slug}` : undefined}
              >
                <header class="system-card__header">
                  <h3>{system.name}</h3>
                  {system.summary && <p class="system-card__summary">{system.summary}</p>}
                </header>
                <dl class="system-meta">
                  {system.architecture && (
                    <div>
                      <dt>アーキテクチャ</dt>
                      <dd>{system.architecture}</dd>
                    </div>
                  )}
                </dl>
                {system.details?.length > 0 && (
                  <ul class="system-details" role="list">
                    {system.details.map((detail) => (
                      <li>{detail}</li>
                    ))}
                  </ul>
                )}
                {system.technologies?.length > 0 && (
                  <div class="system-tech" aria-label="利用技術">
                    {system.technologies.map((tech) => (
                      <span>{tech}</span>
                    ))}
                  </div>
                )}
              </article>
            ))}
          </div>
        </article>
      )}

      <article class="panel panel--certifications">
        <header class="panel__header">
          <h2>Certifications</h2>
          <p class="panel__lead">取得済みの資格・認定バッジ。</p>
        </header>
        {certifications.length > 0 ? (
          <ul class="cert-list">
            {certifications.map((cert) => (
              <li>{cert}</li>
            ))}
          </ul>
        ) : (
          <p class="panel__empty">資格情報は準備中です。</p>
        )}
      </article>

      <article class="panel panel--learning">
        <header class="panel__header">
          <h2>Currently Learning</h2>
          <p class="panel__lead">実務の合間に深掘りしているテーマ。</p>
        </header>
        {learning.length > 0 ? (
          <ul class="learning-list">
            {learning.map((topic) => (
              <li>{topic}</li>
            ))}
          </ul>
        ) : (
          <p class="panel__empty">学習中のトピックは現在整理中です。</p>
        )}
      </article>
    </section>

    <section class="section container">
      <div class="cta-panel">
        <div>
          <h2>プロジェクト単位の実績も合わせて確認</h2>
          <p>
            個別の案件における役割や成果は
            <a href="/projects">Projects</a>
            ページで詳細に紹介しています。スキルの使われ方と合わせてご覧ください。
          </p>
        </div>
        <a class="cta" href="/projects">プロジェクトを見る</a>
      </div>
    </section>
  </article>
</BaseLayout>

<style>
  .page {
    display: flex;
    flex-direction: column;
    gap: clamp(2rem, 4.5vw, 3rem);
  }

  .page__hero {
    padding: clamp(2.3rem, 6.8vw, 3.4rem) clamp(1.35rem, 4.6vw, 2.45rem) clamp(0.9rem, 3vw, 1.5rem);
    display: grid;
    gap: clamp(1.4rem, 3.5vw, 2.05rem);
    position: relative;
    border-radius: clamp(2.1rem, 6vw, 3.1rem);
    overflow: hidden;
    background: linear-gradient(150deg, rgba(18, 30, 72, 0.92), rgba(8, 14, 40, 0.94));
    box-shadow: 0 32px 60px rgba(3, 6, 26, 0.52);
  }

  .page__hero::before,
  .page__hero::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .page__hero::before {
    background:
      radial-gradient(circle at 18% 24%, rgba(124, 92, 255, 0.28), transparent 60%),
      radial-gradient(circle at 78% 16%, rgba(56, 189, 248, 0.25), transparent 58%);
    opacity: 0.85;
  }

  .page__hero::after {
    background: conic-gradient(from 220deg at 75% 15%, rgba(56, 189, 248, 0.18), transparent 150deg);
    mix-blend-mode: screen;
    opacity: 0.55;
  }

  .page__hero > * {
    position: relative;
    z-index: 1;
  }

  .page__eyebrow {
    margin: 0;
    font-size: 0.85rem;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--accent);
  }

  .page__lead {
    margin: 0;
    max-width: 760px;
    color: var(--muted);
  }

  .page__meta {
    margin: 0;
    color: var(--muted);
    font-size: 0.95rem;
  }

  .section {
    display: grid;
    gap: clamp(1.45rem, 3.4vw, 2.1rem);
    padding: clamp(1.75rem, 4.5vw, 2.55rem) clamp(1.3rem, 4.6vw, 2.3rem);
    border-radius: clamp(1.9rem, 5.5vw, 2.8rem);
    position: relative;
    background: linear-gradient(140deg, rgba(18, 30, 72, 0.85), rgba(8, 14, 40, 0.92));
    box-shadow: 0 26px 50px rgba(3, 6, 26, 0.48);
    overflow: hidden;
  }

  .section::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 22% 25%, rgba(124, 92, 255, 0.2), transparent 60%), radial-gradient(circle at 75% 80%, rgba(56, 189, 248, 0.18), transparent 58%);
    opacity: 0.75;
    pointer-events: none;
  }

  .section > * {
    position: relative;
    z-index: 1;
  }

  .panel-grid {
    display: grid;
    grid-template-columns: repeat(12, minmax(0, 1fr));
    gap: clamp(1.25rem, 2.3vw, 1.7rem);
    padding-inline: clamp(1.3rem, 4.6vw, 2.35rem);
    position: relative;
  }

  .panel {
    position: relative;
    background: linear-gradient(150deg, rgba(19, 32, 76, 0.78), rgba(9, 15, 42, 0.92));
    border: 1px solid var(--border);
    border-radius: calc(var(--radius-md) * 0.85);
    box-shadow: 0 24px 52px rgba(3, 6, 26, 0.48);
    padding: clamp(1.4rem, 3vw, 2rem);
    display: grid;
    gap: clamp(0.9rem, 2.1vw, 1.35rem);
    align-content: flex-start;
    overflow: hidden;
    transition: border-color 0.3s ease;
  }

  .panel::before,
  .panel::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .panel::before {
    background: radial-gradient(circle at 18% 22%, rgba(124, 92, 255, 0.24), transparent 60%), radial-gradient(circle at 82% 78%, rgba(56, 189, 248, 0.2), transparent 60%);
    opacity: 0.75;
  }

  .panel::after {
    background: conic-gradient(from 160deg at 80% 15%, rgba(56, 189, 248, 0.18), transparent 150deg);
    opacity: 0.65;
  }

  .panel > * {
    position: relative;
    z-index: 1;
  }

  .panel:focus-within {
    border-color: rgba(124, 146, 220, 0.35);
    outline: none;
  }

  .panel:focus-within::after {
    opacity: 0.8;
  }

  .panel--skills {
    grid-column: span 12;
  }

  .panel--systems {
    grid-column: span 12;
  }

  .panel--certifications,
  .panel--learning {
    grid-column: span 6;
  }

  .panel__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1.15rem;
  }

  .panel__header h2 {
    margin: 0 0 0.35rem;
  }

  .panel__lead {
    margin: 0;
    color: var(--muted);
    font-size: 0.96rem;
  }

  .panel__meta {
    color: var(--muted);
    font-weight: 600;
    font-variant-numeric: tabular-nums;
  }

  .panel__charts {
    display: grid;
    gap: clamp(0.95rem, 1.8vw, 1.4rem);
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    align-items: stretch;
  }

  .system-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: clamp(1.25rem, 2.6vw, 1.9rem);
  }

  .system-card {
    display: grid;
    gap: clamp(0.85rem, 1.8vw, 1.2rem);
    padding: clamp(1.2rem, 2.6vw, 1.7rem);
    border-radius: calc(var(--radius-md) * 0.85);
    background: linear-gradient(150deg, rgba(18, 30, 70, 0.78), rgba(10, 16, 44, 0.92));
    border: 1px solid rgba(124, 146, 220, 0.3);
    box-shadow: 0 24px 52px rgba(3, 6, 26, 0.48);
    position: relative;
    overflow: hidden;
  }

  .system-card::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 78% 18%, rgba(56, 189, 248, 0.28), transparent 60%);
    opacity: 0.7;
  }

  .system-card > * {
    position: relative;
    z-index: 1;
  }

  .system-card__header h3 {
    margin: 0;
  }

  .system-card__summary {
    margin: 0.35rem 0 0;
    color: var(--muted);
  }

  .system-meta {
    margin: 0;
    display: grid;
    gap: 0.5rem;
  }

  .system-meta div {
    display: grid;
    gap: 0.25rem;
  }

  .system-meta dt {
    margin: 0;
    font-size: 0.85rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .system-meta dd {
    margin: 0;
    font-weight: 600;
  }

  .system-details {
    margin: 0;
    padding-left: 1.3rem;
    display: grid;
    gap: 0.6rem;
    color: var(--muted);
  }

  .system-tech {
    display: flex;
    flex-wrap: wrap;
    gap: 0.55rem;
  }

  .system-tech span {
    display: inline-flex;
    align-items: center;
    padding: 0.4rem 0.85rem;
    border-radius: 999px;
    background: linear-gradient(120deg, rgba(124, 92, 255, 0.25), rgba(56, 189, 248, 0.2));
    color: #f5f3ff;
    font-weight: 600;
    font-size: 0.85rem;
  }

  .chart-card {
    display: grid;
    gap: 0.95rem;
    padding: 1.2rem 1.35rem;
    border-radius: var(--radius-sm);
    border: 1px solid rgba(124, 146, 220, 0.28);
    background: linear-gradient(135deg, rgba(15, 32, 72, 0.78), rgba(8, 16, 38, 0.9));
    position: relative;
    overflow: hidden;
  }

  .chart-card::before {
    content: '';
    position: absolute;
    inset: -30% -40% auto auto;
    width: 160px;
    height: 160px;
    background: radial-gradient(circle, rgba(56, 189, 248, 0.28), transparent 70%);
    opacity: 0.6;
  }

  .chart-card > * {
    position: relative;
    z-index: 1;
  }

  .chart-card header {
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }

  .chart-card h3 {
    margin: 0;
    font-size: 1rem;
    overflow-wrap: anywhere;
  }

  .bar-chart {
    margin: 0;
    padding: 0;
    list-style: none;
    display: grid;
    gap: clamp(0.75rem, 1.8vw, 1.15rem);
  }

  .bar-chart__item {
    display: grid;
    gap: 0.5rem;
  }

  .bar-chart__meta {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .bar-chart__label {
    font-weight: 600;
    color: #f8fafc;
    word-break: break-word;
    flex: 1 1 180px;
  }

  .bar-chart__count {
    font-variant-numeric: tabular-nums;
    color: var(--muted);
    font-weight: 600;
  }

  .bar-chart__track {
    position: relative;
    width: 100%;
    height: clamp(0.68rem, 1.6vw, 0.9rem);
    border-radius: 999px;
    background: rgba(124, 146, 220, 0.18);
    overflow: hidden;
  }

  .bar-chart__fill {
    position: absolute;
    inset: 0;
    width: calc((min(var(--value), var(--max)) / var(--max)) * 100%);
    background: linear-gradient(90deg, rgba(124, 92, 255, 0.68), rgba(56, 189, 248, 0.85));
    border-radius: inherit;
    transition: width 0.25s ease-out;
  }

  .cert-list {
    margin: 0;
    padding-left: 1.4rem;
    display: grid;
    gap: 0.65rem;
    color: var(--muted);
  }

  .panel__empty {
    margin: 0;
    color: var(--muted);
    font-size: 0.95rem;
  }

  .learning-list {
    margin: 0;
    padding: 0;
    list-style: none;
    display: flex;
    flex-wrap: wrap;
    gap: 0.65rem;
  }

  .learning-list li {
    padding: 0.6rem 1.2rem;
    border-radius: 999px;
    background: linear-gradient(120deg, rgba(124, 92, 255, 0.28), rgba(56, 189, 248, 0.2));
    color: #f5f3ff;
    font-weight: 600;
    font-size: 0.95rem;
  }

  .cta-panel {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: clamp(1.6rem, 4vw, 2.6rem);
    padding: clamp(2rem, 4.5vw, 2.6rem);
    border-radius: var(--radius-md);
    background: linear-gradient(135deg, rgba(124, 92, 255, 0.28), rgba(56, 189, 248, 0.2));
    border: 1px solid rgba(124, 146, 220, 0.32);
    box-shadow: 0 24px 52px rgba(3, 6, 26, 0.45);
    position: relative;
    overflow: hidden;
  }

  .cta-panel::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 82% 20%, rgba(56, 189, 248, 0.32), transparent 60%);
    opacity: 0.7;
  }

  .cta-panel > * {
    position: relative;
    z-index: 1;
  }

  .cta-panel p {
    margin: 0;
    color: var(--muted);
  }

  .cta-panel a {
    color: var(--accent);
    font-weight: 600;
    text-decoration: none;
  }

  .cta-panel a:hover,
  .cta-panel a:focus {
    text-decoration: underline;
  }

  .cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.85rem 1.75rem;
    border-radius: 999px;
    background: linear-gradient(120deg, rgba(124, 92, 255, 0.9), rgba(56, 189, 248, 0.85));
    color: #0b1024;
    text-decoration: none;
    font-weight: 600;
    box-shadow: 0 24px 48px rgba(124, 92, 255, 0.35);
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }

  .cta:hover,
  .cta:focus {
    transform: translateY(-3px);
    box-shadow: 0 30px 56px rgba(124, 92, 255, 0.4);
  }

  .cta-panel .cta {
    color: #f8fafc;
  }

  @media (max-width: 1024px) {
    .panel-grid {
      grid-template-columns: repeat(6, minmax(0, 1fr));
    }

    .panel--skills,
    .panel--systems,
    .panel--certifications,
    .panel--learning {
      grid-column: span 6;
    }
  }

  @media (max-width: 880px) {
    .cta-panel {
      flex-direction: column;
      align-items: flex-start;
    }
  }

  @media (max-width: 640px) {
    .panel-grid {
      grid-template-columns: 1fr;
      padding-inline: clamp(1.2rem, 5.5vw, 2rem);
    }

    .panel {
      padding: clamp(1.5rem, 6.5vw, 1.9rem);
    }

    .panel__header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.85rem;
    }

    .page__hero {
      border-radius: clamp(2rem, 8vw, 2.7rem);
      padding: clamp(2.7rem, 9vw, 3.3rem) clamp(1.4rem, 6vw, 2.1rem) clamp(1.2rem, 6vw, 1.8rem);
    }

    .section {
      padding: clamp(2rem, 8vw, 2.6rem) clamp(1.4rem, 6vw, 2.1rem);
      border-radius: clamp(1.8rem, 8vw, 2.5rem);
    }
  }

  @media (max-width: 520px) {
    .panel__charts {
      grid-template-columns: 1fr;
    }

    .bar-chart__meta {
      gap: 0.5rem;
    }

    .bar-chart__label,
    .bar-chart__count {
      flex: 1 1 100%;
    }

    .bar-chart__count {
      text-align: left;
    }
  }
</style>
